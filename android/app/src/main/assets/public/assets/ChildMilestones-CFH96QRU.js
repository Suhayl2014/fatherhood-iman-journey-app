import{j as e}from"./ui-vendor-C7McgsY-.js";import{j as P,e as Y,r as n}from"./react-vendor-BhqeUVA1.js";import{u as H,H as O,B as p,F as W,s as y,t as x}from"./index-BImgQHmp.js";import{m as b}from"./milestones-CBoGx6zn.js";import{C as L,a as U,b as q,c as V,d as z,e as X}from"./card-DjuXh6RO.js";import{I as M}from"./input-DPPaCPuN.js";import{B as _}from"./badge-ByhtEUZ7.js";import{D as G,f as J,a as K,b as Q,c as Z,d as ee,e as se}from"./dialog-CDH1IPmJ.js";import{T as te,a as ae,b as C,c as re}from"./tabs-9HacetrH.js";import{A as le,a as ie,h as ne,l as ce,X as de,m as oe}from"./icons-CbYejn_e.js";const we=()=>{const{childId:a}=P(),o=Y(),{user:c}=H(),[i,v]=n.useState(null),[m,u]=n.useState([]),[g,f]=n.useState(null),[h,D]=n.useState(""),[S,T]=n.useState(""),[k,N]=n.useState(!1),[A,j]=n.useState(!0),[w,E]=n.useState("all");n.useEffect(()=>{(async()=>{if(!a||!c){j(!1);return}try{const{data:t,error:r}=await y.from("children").select("*").eq("id",a).eq("user_id",c.id).single();if(r){console.error("Error fetching child:",r),x({title:"Error fetching child data",description:r.message||"We couldn't find this child in your records.",variant:"destructive"}),j(!1);return}if(!t){x({title:"Child not found",description:"We couldn't find this child in your records.",variant:"destructive"}),j(!1);return}v(t);const{data:d,error:l}=await y.from("child_milestones").select("*").eq("child_id",a);l&&(console.error("Error fetching milestones:",l),x({title:"Error fetching milestones",description:l.message||"We couldn't load the milestone data.",variant:"destructive"})),u(d||[])}catch(t){console.error("Error in fetchData:",t),x({title:"Error loading data",description:t.message||"There was a problem loading the data. Please try again.",variant:"destructive"})}finally{j(!1)}})()},[a,c]);const F=async()=>{if(!g||!a||!c||!h){x({title:"Missing information",description:"Please select a date when this milestone was achieved",variant:"destructive"});return}try{const{data:s,error:t}=await y.from("child_milestones").insert({child_id:a,milestone_id:g.id,completed_date:h,notes:S||null}).select();if(t)throw t;s&&(u([...m,s[0]]),x({title:"Milestone recorded",description:`You've recorded the "${g.title}" milestone!`}),f(null),D(""),T(""),N(!1))}catch(s){x({title:"Error recording milestone",description:s.message,variant:"destructive"})}},$=()=>{const s=new Set(m.map(t=>t.milestone_id));return b.filter(t=>w==="completed"?s.has(t.id):w==="pending"?!s.has(t.id):!0)},I=s=>m.find(t=>t.milestone_id===s),B=s=>{const t=new Date(s);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"long",day:"numeric"}).format(t)},R=s=>{const t=new Date,r=new Date(s);let d=t.getFullYear()-r.getFullYear(),l=t.getMonth()-r.getMonth();return(l<0||l===0&&t.getDate()<r.getDate())&&(d--,l+=12),d===0?`${l} months`:d===1&&l===0?`${d} year`:d>=1&&l===0?`${d} years`:`${d} years, ${l} months`};return e.jsxs("div",{className:"flex flex-col min-h-screen",children:[e.jsx(O,{}),e.jsx("main",{className:"flex-grow py-8",children:e.jsxs("div",{className:"container-app",children:[e.jsxs(p,{variant:"ghost",className:"mb-6",onClick:()=>o("/dashboard"),children:[e.jsx(le,{className:"mr-2 h-4 w-4"})," Back to Dashboard"]}),A?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"h-10 w-10 animate-spin rounded-full border-b-2 border-t-2 border-islamic-green"})}):i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"bg-gradient-to-r from-islamic-green to-islamic-teal text-white p-6 rounded-lg shadow",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx(ie,{className:"h-8 w-8"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold",children:[i.name,"'s Milestones"]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(ne,{className:"h-4 w-4 mr-1"}),B(i.date_of_birth)]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"w-2 h-2 bg-white rounded-full mr-2"}),R(i.date_of_birth)]}),e.jsx("span",{className:"capitalize",children:i.gender})]})]})]}),e.jsxs("div",{className:"mt-6 flex flex-col sm:flex-row sm:items-center gap-4 justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm opacity-80",children:"Completed Milestones"}),e.jsxs("div",{className:"text-2xl font-bold",children:[m.length," of ",b.length]})]}),e.jsxs(G,{open:k,onOpenChange:N,children:[e.jsx(J,{asChild:!0,children:e.jsxs(p,{className:"bg-white text-islamic-green hover:bg-white/90",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"})," Record Milestone"]})}),e.jsxs(K,{children:[e.jsxs(Q,{children:[e.jsx(Z,{children:"Record a Milestone"}),e.jsxs(ee,{children:["Select a milestone that ",i.name," has achieved and when it happened."]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Select Milestone"}),e.jsxs("select",{className:"w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",value:g?.id||"",onChange:s=>{const t=b.find(r=>r.id===s.target.value);f(t||null)},children:[e.jsx("option",{value:"",children:"Select a milestone..."}),b.filter(s=>!m.some(t=>t.milestone_id===s.id)).map(s=>e.jsxs("option",{value:s.id,children:[s.title," (",s.ageRange," - ",s.category,")"]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"When was this milestone achieved?"}),e.jsx(M,{type:"date",value:h,onChange:s=>D(s.target.value),max:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Notes (Optional)"}),e.jsx(M,{placeholder:"Add any observations or special memories",value:S,onChange:s=>T(s.target.value)})]})]}),e.jsxs(se,{children:[e.jsx(p,{variant:"outline",onClick:()=>N(!1),children:"Cancel"}),e.jsx(p,{onClick:F,children:"Save"})]})]})]})]})]})}),e.jsx("div",{className:"mb-6",children:e.jsxs(te,{defaultValue:"all",onValueChange:E,children:[e.jsxs(ae,{className:"mb-6",children:[e.jsx(C,{value:"all",children:"All Milestones"}),e.jsx(C,{value:"completed",children:"Completed"}),e.jsx(C,{value:"pending",children:"Not Yet Achieved"})]}),e.jsx(re,{value:w,className:"mt-0",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:$().map(s=>{const t=I(s.id),r=!!t;return e.jsx(me,{milestone:s,childMilestone:t,isCompleted:r},s.id)})})})]})})]}):e.jsx("div",{className:"text-center py-12",children:e.jsxs("div",{className:"bg-white rounded-lg shadow p-8 max-w-2xl mx-auto",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(de,{className:"h-8 w-8 text-red-500"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2 text-gray-900",children:"Child Not Found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"We couldn't find this child in your records. This could be because:"}),e.jsxs("ul",{className:"text-left text-gray-600 mb-6 space-y-2",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full mr-2"}),"The child ID in the URL is incorrect"]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full mr-2"}),"The child has been deleted from your records"]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full mr-2"}),"You don't have permission to view this child's records"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsx(p,{onClick:()=>o("/dashboard"),variant:"outline",children:"Return to Dashboard"}),e.jsx(p,{onClick:()=>o("/add-child"),children:"Add New Child"})]})]})})]})}),e.jsx(W,{})]})},me=({milestone:a,childMilestone:o,isCompleted:c})=>{const[i,v]=n.useState(!1),m=()=>{switch(a.category){case"physical":return"bg-islamic-green/10";case"cognitive":return"bg-islamic-blue/10";case"social":return"bg-islamic-teal/10";case"emotional":return"bg-red-500/10";case"spiritual":return"bg-islamic-gold/10";default:return"bg-gray-100"}},u=()=>{switch(a.category){case"physical":return"text-islamic-green";case"cognitive":return"text-islamic-blue";case"social":return"text-islamic-teal";case"emotional":return"text-red-500";case"spiritual":return"text-islamic-gold";default:return"text-gray-800"}},g=f=>{const h=new Date(f);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"long",day:"numeric"}).format(h)};return e.jsxs(L,{className:`overflow-hidden card-hover h-full flex flex-col ${c?"border-green-500 shadow-sm":""}`,children:[e.jsxs(U,{className:"pb-2 relative",children:[c&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsxs(_,{className:"bg-green-500 text-white",children:[e.jsx(oe,{className:"h-3 w-3 mr-1"})," Achieved"]})}),e.jsx(_,{className:`${m()} ${u()} border-none mb-2 mt-4`,children:a.category.charAt(0).toUpperCase()+a.category.slice(1)}),e.jsx(q,{className:u(),children:a.title}),e.jsx(V,{className:"flex items-center mt-1",children:e.jsx("span",{className:"text-sm font-medium",children:a.ageRange})}),c&&o&&e.jsx("div",{className:"mt-2 text-sm text-gray-500",children:e.jsxs("span",{children:["Achieved on ",g(o.completed_date)]})})]}),e.jsxs(z,{className:"flex-grow",children:[e.jsx("div",{className:"mb-4 mt-2",children:e.jsx("p",{className:"text-gray-600",children:a.description})}),e.jsxs("div",{className:"mb-4 mt-2",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-2",children:"Islamic Perspective:"}),e.jsx("p",{className:"text-gray-600",children:a.islamicPerspective})]}),i&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-2",children:"Tips for Fathers:"}),e.jsx("ul",{className:"list-disc pl-5 space-y-1",children:a.tips.map((f,h)=>e.jsx("li",{className:"text-gray-600",children:f},h))})]}),c&&o?.notes&&e.jsxs("div",{className:"mt-4 bg-gray-50 p-3 rounded-md",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-1",children:"Your Notes:"}),e.jsx("p",{className:"text-gray-600",children:o.notes})]})]}),e.jsx(X,{children:e.jsx("button",{onClick:()=>v(!i),className:`text-sm font-medium ${u()} hover:underline`,children:i?"Hide tips":"Show tips for fathers"})})]})};export{we as default};
